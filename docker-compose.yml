version: '3'
services:
  postgres:
    image: postgres:latest
    container_name: postgres
    ports:
      - "5432:5432"
    environment:
       POSTGRES_PASSWORD: todo_password
       POSTGRES_USER: todo_admin
       POSTGRES_DB: todo_db
    
  todo:
    build: ./to_do
    ports:
      - "8001:8000"
    depends_on:
      - "postgres"
    environment:
      SECRET_KEY: django-insecure-uu)iin6l^7*9f(a4apz8fk!#wod560c3f@ebym5#cz^w!g#^g_
      DEBUG: False
      DOMAIN_NAME: localhost:8000
      ALLOWED_HOSTS: 127.0.0.1
      DB_HOST: "postgres"
      INTERNAL_IPS : 127.0.0.1
      REDIS_PASSWORD : to_do_password
    volumes:
      - static_volume:/app/static

  nginx:
    image: nginx:latest
    ports:
      - "80:80"
    depends_on:
      - "todo"
      - "postgres"
    volumes:
      - ./conf/nginx.conf:/etc/nginx/nginx.conf
      - static_volume:/static

volumes:
  static_volume:

